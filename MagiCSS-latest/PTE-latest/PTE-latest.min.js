/*!
 * Amplify Store - Persistent Client-Side Storage 1.1.0
 *
 * Copyright 2011 appendTo LLC. (http://appendto.com/team)
 * Dual licensed under the MIT or GPL licenses.
 * http://appendto.com/open-source-licenses
 *
 * http://amplifyjs.com
 */
(function(a, b) {
    function e(a, e) {
        c.addType(a, function(f, g, h) {
            var i, j, k, l, m = g,
                n = (new Date).getTime();
            if (!f) {
                m = {}, l = [], k = 0;
                try {
                    f = e.length;
                    while (f = e.key(k++)) {
                        d.test(f) && (j = JSON.parse(e.getItem(f)), j.expires && j.expires <= n ? l.push(f) : m[f.replace(d, "")] = j.data)
                    }
                    while (f = l.pop()) {
                        e.removeItem(f)
                    }
                } catch (o) {}
                return m
            }
            f = "__amplify__" + f;
            if (g === b) {
                i = e.getItem(f), j = i ? JSON.parse(i) : {
                    expires: -1
                };
                if (j.expires && j.expires <= n) {
                    e.removeItem(f)
                } else {
                    return j.data
                }
            } else {
                if (g === null) {
                    e.removeItem(f)
                } else {
                    j = JSON.stringify({
                        data: g,
                        expires: h.expires ? n + h.expires : null
                    });
                    try {
                        e.setItem(f, j)
                    } catch (o) {
                        c[a]();
                        try {
                            e.setItem(f, j)
                        } catch (o) {
                            throw c.error()
                        }
                    }
                }
            }
            return m
        })
    }
    var c = a.store = function(a, b, d, e) {
        var e = c.type;
        d && d.type && d.type in c.types && (e = d.type);
        return c.types[e](a, b, d || {})
    };
    c.types = {}, c.type = null, c.addType = function(a, b) {
        c.type || (c.type = a), c.types[a] = b, c[a] = function(b, d, e) {
            e = e || {}, e.type = a;
            return c(b, d, e)
        }
    }, c.error = function() {
        return "amplify.store quota exceeded"
    };
    var d = /^__amplify__/;
    for (var f in {
            localStorage: 1,
            sessionStorage: 1
        }) {
        try {
            window[f].getItem && e(f, window[f])
        } catch (g) {}
    }
    if (window.globalStorage) {
        try {
            e("globalStorage", window.globalStorage[window.location.hostname]), c.type === "sessionStorage" && (c.type = "globalStorage")
        } catch (g) {}
    }(function() {
        if (!c.types.localStorage) {
            var a = document.createElement("div"),
                d = "amplify";
            a.style.display = "none", document.getElementsByTagName("head")[0].appendChild(a);
            try {
                a.addBehavior("#default#userdata"), a.load(d)
            } catch (e) {
                a.parentNode.removeChild(a);
                return
            }
            c.addType("userData", function(e, f, g) {
                a.load(d);
                var h, i, j, k, l, m = f,
                    n = (new Date).getTime();
                if (!e) {
                    m = {}, l = [], k = 0;
                    while (h = a.XMLDocument.documentElement.attributes[k++]) {
                        i = JSON.parse(h.value), i.expires && i.expires <= n ? l.push(h.name) : m[h.name] = i.data
                    }
                    while (e = l.pop()) {
                        a.removeAttribute(e)
                    }
                    a.save(d);
                    return m
                }
                e = e.replace(/[^-._0-9A-Za-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u37f-\u1fff\u200c-\u200d\u203f\u2040\u2070-\u218f]/g, "-");
                if (f === b) {
                    h = a.getAttribute(e), i = h ? JSON.parse(h) : {
                        expires: -1
                    };
                    if (i.expires && i.expires <= n) {
                        a.removeAttribute(e)
                    } else {
                        return i.data
                    }
                } else {
                    f === null ? a.removeAttribute(e) : (j = a.getAttribute(e), i = JSON.stringify({
                        data: f,
                        expires: g.expires ? n + g.expires : null
                    }), a.setAttribute(e, i))
                }
                try {
                    a.save(d)
                } catch (o) {
                    j === null ? a.removeAttribute(e) : a.setAttribute(e, j), c.userData();
                    try {
                        a.setAttribute(e, i), a.save(d)
                    } catch (o) {
                        j === null ? a.removeAttribute(e) : a.setAttribute(e, j);
                        throw c.error()
                    }
                }
                return m
            })
        }
    })(),
    function() {
        function e(a) {
            return a === b ? b : JSON.parse(JSON.stringify(a))
        }
        var a = {},
            d = {};
        c.addType("memory", function(c, f, g) {
            if (!c) {
                return e(a)
            }
            if (f === b) {
                return e(a[c])
            }
            d[c] && (clearTimeout(d[c]), delete d[c]);
            if (f === null) {
                delete a[c];
                return null
            }
            a[c] = f, g.expires && (d[c] = setTimeout(function() {
                delete a[c], delete d[c]
            }, g.expires));
            return f
        })
    }()
})(this.amplify = this.amplify || {});
(function() {
    var jQuery, $;
    var consoleLog = function(msg) {
        if (typeof window.console === "object") {
            try {
                window.console.log(msg)
            } catch (e) {}
        }
    };
    var alertNote = (function() {
        var w = window,
            d = document,
            b = d.body;
        var div = d.createElement("div");
        var t;
        var h = function(div) {
            div.style.display = "none"
        };
        var clearTimeout = function() {
            w.clearTimeout(t)
        };
        var alertNote = function(msg, hideDelay) {
            div.innerHTML = ['<div style="position:fixed;left:0;top:0;width:100%;text-align:center;height:0;z-index:2147483647">', '<table style="display:inline-table;border-collapse:collapse;width:auto"><tr><td style="padding:0px;border:0">', '<div style="border:1px solid #eb7;background-color:#f9edbe;margin:0 10px;padding:2px 10px;max-width:980px;overflow:hidden;text-align:left;font:bold 13px Arial">', '<div style="clear:both">', '<div style="float:left;color:#000;text-align:center;">', msg, "</div>", "</div>", "</div>", "</td></tr></table>", "</div>"].join("");
            div.style.display = "";
            b.appendChild(div);
            clearTimeout();
            t = w.setTimeout(function() {
                h(div)
            }, hideDelay || 5000)
        };
        alertNote.hide = function() {
            h(div);
            clearTimeout()
        };
        return alertNote
    }());
    var runOnceFor = function(fn, delay) {
        clearTimeout(fn.timer);
        fn.timer = setTimeout(fn, delay)
    };
    var addCSSLinkTag = function(config) {
        var cssFileParentPath = config.cssFileParentPath;
        var cssFileName = config.cssFileName;
        var parentTag = "body";
        if (config.parentTag && config.parentTag.toLowerCase() === "head") {
            parentTag = "head"
        }
        var cssNode = document.createElement("link");
        cssNode.type = "text/css";
        cssNode.rel = "stylesheet";
        cssNode.href = cssFileParentPath + cssFileName + (config.freshCopy === false ? "" : ("?" + Math.random()));
        cssNode.media = "screen";
        document.getElementsByTagName(parentTag)[0].appendChild(cssNode)
    };
    var inSequence = (function() {
        var DefInSequence = function(sequence) {
            if (this === window || this === undefined) {
                return (new DefInSequence(sequence))
            }
            var i = this.index = 0;
            var states = this.sequence = sequence;
            this.vars = {};
            if (states && states[i] && typeof states[i] === "function") {
                states[i](this.getNext())
            }
        };
        DefInSequence.prototype.getNext = function() {
            var that = this;
            return function() {
                that.index++;
                var i = that.index;
                var states = that.sequence;
                if (states[i]) {
                    var fnNext = states[i];
                    if (typeof fnNext === "function") {
                        var args = Array.prototype.slice.call(arguments);
                        fnNext.apply(that, [that.getNext()].concat(args))
                    }
                }
            }
        };
        return DefInSequence
    }).call(this);
    var fnInitRangyInputs = function($) {
        var UNDEF = "undefined";
        var getSelection, setSelection, deleteSelectedText, deleteText, insertText;
        var replaceSelectedText, surroundSelectedText, extractSelectedText, collapseSelection;

        function isHostMethod(object, property) {
            var t = typeof object[property];
            return t === "function" || (!!(t === "object" && object[property])) || t === "unknown"
        }

        function isHostProperty(object, property) {
            return typeof(object[property]) != UNDEF
        }

        function isHostObject(object, property) {
            return !!(typeof(object[property]) === "object" && object[property])
        }

        function fail(reason) {
            if (window.console && window.console.log) {
                window.console.log("RangyInputs not supported in your browser. Reason: " + reason)
            }
        }

        function adjustOffsets(el, start, end) {
            if (start < 0) {
                start += el.value.length
            }
            if (typeof end == UNDEF) {
                end = start
            }
            if (end < 0) {
                end += el.value.length
            }
            return {
                start: start,
                end: end
            }
        }

        function makeSelection(el, start, end) {
            return {
                start: start,
                end: end,
                length: end - start,
                text: el.value.slice(start, end)
            }
        }

        function getBody() {
            return isHostObject(document, "body") ? document.body : document.getElementsByTagName("body")[0]
        }
        $(function() {
            var testTextArea = document.createElement("textarea");
            getBody().appendChild(testTextArea);
            if (isHostProperty(testTextArea, "selectionStart") && isHostProperty(testTextArea, "selectionEnd")) {
                getSelection = function(el) {
                    var start = el.selectionStart,
                        end = el.selectionEnd;
                    return makeSelection(el, start, end)
                };
                setSelection = function(el, startOffset, endOffset) {
                    var offsets = adjustOffsets(el, startOffset, endOffset);
                    el.selectionStart = offsets.start;
                    el.selectionEnd = offsets.end
                };
                collapseSelection = function(el, toStart) {
                    if (toStart) {
                        el.selectionEnd = el.selectionStart
                    } else {
                        el.selectionStart = el.selectionEnd
                    }
                }
            } else {
                if (isHostMethod(testTextArea, "createTextRange") && isHostObject(document, "selection") && isHostMethod(document.selection, "createRange")) {
                    getSelection = function(el) {
                        var start = 0,
                            end = 0,
                            normalizedValue, textInputRange, len, endRange;
                        var range = document.selection.createRange();
                        if (range && range.parentElement() == el) {
                            len = el.value.length;
                            normalizedValue = el.value.replace(/\r\n/g, "\n");
                            textInputRange = el.createTextRange();
                            textInputRange.moveToBookmark(range.getBookmark());
                            endRange = el.createTextRange();
                            endRange.collapse(false);
                            if (textInputRange.compareEndPoints("StartToEnd", endRange) > -1) {
                                start = end = len
                            } else {
                                start = -textInputRange.moveStart("character", -len);
                                start += normalizedValue.slice(0, start).split("\n").length - 1;
                                if (textInputRange.compareEndPoints("EndToEnd", endRange) > -1) {
                                    end = len
                                } else {
                                    end = -textInputRange.moveEnd("character", -len);
                                    end += normalizedValue.slice(0, end).split("\n").length - 1
                                }
                            }
                        }
                        return makeSelection(el, start, end)
                    };
                    var offsetToRangeCharacterMove = function(el, offset) {
                        return offset - (el.value.slice(0, offset).split("\r\n").length - 1)
                    };
                    setSelection = function(el, startOffset, endOffset) {
                        var offsets = adjustOffsets(el, startOffset, endOffset);
                        var range = el.createTextRange();
                        var startCharMove = offsetToRangeCharacterMove(el, offsets.start);
                        range.collapse(true);
                        if (offsets.start == offsets.end) {
                            range.move("character", startCharMove)
                        } else {
                            range.moveEnd("character", offsetToRangeCharacterMove(el, offsets.end));
                            range.moveStart("character", startCharMove)
                        }
                        range.select()
                    };
                    collapseSelection = function(el, toStart) {
                        var range = document.selection.createRange();
                        range.collapse(toStart);
                        range.select()
                    }
                } else {
                    getBody().removeChild(testTextArea);
                    fail("No means of finding text input caret position");
                    return
                }
            }
            getBody().removeChild(testTextArea);
            deleteText = function(el, start, end, moveSelection) {
                var val;
                if (start != end) {
                    val = el.value;
                    el.value = val.slice(0, start) + val.slice(end)
                }
                if (moveSelection) {
                    setSelection(el, start, start)
                }
            };
            deleteSelectedText = function(el) {
                var sel = getSelection(el);
                deleteText(el, sel.start, sel.end, true)
            };
            extractSelectedText = function(el) {
                var sel = getSelection(el),
                    val;
                if (sel.start != sel.end) {
                    val = el.value;
                    el.value = val.slice(0, sel.start) + val.slice(sel.end)
                }
                setSelection(el, sel.start, sel.start);
                return sel.text
            };
            insertText = function(el, text, index, moveSelection) {
                var val = el.value,
                    caretIndex;
                el.value = val.slice(0, index) + text + val.slice(index);
                if (moveSelection) {
                    caretIndex = index + text.length;
                    setSelection(el, caretIndex, caretIndex)
                }
            };
            replaceSelectedText = function(el, text) {
                var sel = getSelection(el),
                    val = el.value;
                el.value = val.slice(0, sel.start) + text + val.slice(sel.end);
                var caretIndex = sel.start + text.length;
                setSelection(el, caretIndex, caretIndex)
            };
            surroundSelectedText = function(el, before, after) {
                if (typeof after === UNDEF) {
                    after = before
                }
                var sel = getSelection(el),
                    val = el.value;
                el.value = val.slice(0, sel.start) + before + sel.text + after + val.slice(sel.end);
                var startIndex = sel.start + before.length;
                var endIndex = startIndex + sel.length;
                setSelection(el, startIndex, endIndex)
            };

            function jQuerify(func, returnThis) {
                return function() {
                    var el = this.jquery ? this[0] : this;
                    var nodeName = el.nodeName.toLowerCase();
                    if (el.nodeType === 1 && (nodeName === "textarea" || (nodeName === "input" && el.type === "text"))) {
                        var args = [el].concat(Array.prototype.slice.call(arguments));
                        var result = func.apply(this, args);
                        if (!returnThis) {
                            return result
                        }
                    }
                    if (returnThis) {
                        return this
                    }
                }
            }
            $.fn.extend({
                getSelection: jQuerify(getSelection, false),
                setSelection: jQuerify(setSelection, true),
                collapseSelection: jQuerify(collapseSelection, true),
                deleteSelectedText: jQuerify(deleteSelectedText, true),
                deleteText: jQuerify(deleteText, true),
                extractSelectedText: jQuerify(extractSelectedText, false),
                insertText: jQuerify(insertText, true),
                replaceSelectedText: jQuerify(replaceSelectedText, true),
                surroundSelectedText: jQuerify(surroundSelectedText, true)
            });
            $.fn.rangyInputs = {
                getSelection: getSelection,
                setSelection: setSelection,
                collapseSelection: collapseSelection,
                deleteSelectedText: deleteSelectedText,
                deleteText: deleteText,
                extractSelectedText: extractSelectedText,
                insertText: insertText,
                replaceSelectedText: replaceSelectedText,
                surroundSelectedText: surroundSelectedText
            }
        })
    };
    var insertTextInFocusedTag = function($, input, text, config) {
        var $input = $(input);
        var start = $input.getSelection().start;
        var end = $input.getSelection().end;
        var value = $input.val();
        if (text === "\t") {
            $input.replaceSelectedText("\t")
        } else {
            if (text === "\r") {
                $input.replaceSelectedText("\n")
            } else {
                if (config.command === "duplicate") {}
            }
        }
    };
    var refreshCodeMirror = function(cm) {
        var $cm = $(cm.getScrollerElement()).closest(".CodeMirror");
        $cm.find(".CodeMirror-vscrollbar > div").eq(0).css("height", "1px");
        $cm.find(".CodeMirror-hscrollbar > div").eq(0).css("width", "1px");
        cm.refresh()
    };
    var PlainTextEditor = (function() {
        var fnPreventNewObjectCreation = function(o) {
            if (o && o.id) {
                var containerEl = document.getElementById(o.id);
                if (containerEl) {
                    return containerEl.pteObject
                }
            }
            return false
        };
        var DefPlainTextEditor = function(options) {
            if (this === window || this === undefined) {
                var returnedObject = fnPreventNewObjectCreation(options);
                if (returnedObject) {
                    return returnedObject
                }
                return (new DefPlainTextEditor(options))
            }
            if (!options) {
                options = {}
            }
            var defaults = {
                title: "TextEd",
                tooltip: "A simple text editor",
                placeholder: "Write your notes here...",
                syntaxHighlighting: {
                    enabled: false,
                    language: "css",
                    useIcon: false
                },
                useClearIcon: true,
                useCloseIcon: true,
                resizable: true,
                closeOnEscapeKey: true,
                rememberText: true,
                rememberDimensions: true,
                textareaWrapAttr: "off",
                bgColor: "54,64,118,0.75"
            };
            this.originalOptions = options;
            this.finalOptions = $.extend({}, defaults, this.originalOptions);
            if (!this.events) {
                this.events = {}
            }
        };
        DefPlainTextEditor.prototype.create = function() {
            var finalOptions = this.finalOptions;
            var thisOb = this;
            thisOb.$ = jQuery;
            thisOb.finalOptions = finalOptions;
            var options = jQuery.extend(true, {}, finalOptions);
            thisOb.options = options;
            var syntaxHighlighting = options.syntaxHighlighting || false;
            var rememberText = true;
            if (options.rememberText === false || options.rememberText === null) {
                rememberText = false
            }
            if (!options.id) {
                rememberText = false
            }
            thisOb.options.rememberText = rememberText;
            var rememberDimensions = true;
            if (options.rememberDimensions === false || options.rememberDimensions === null) {
                rememberDimensions = false
            }
            if (!options.id) {
                rememberDimensions = false
            }
            thisOb.options.rememberDimensions = rememberDimensions;
            var localDataKeyPrefix = "";
            if (rememberText || rememberDimensions) {
                localDataKeyPrefix = options.id + "-"
            }
            thisOb.options.localDataKeyPrefix = localDataKeyPrefix;
            if (rememberDimensions) {
                try {
                    thisOb.userPreference("ui-size-width")
                } catch (e) {
                    thisOb.userPreference("ui-size-width", thisOb.defaultPreference("ui-size-width"))
                }
                try {
                    thisOb.userPreference("ui-size-height")
                } catch (e) {
                    thisOb.userPreference("ui-size-height", thisOb.defaultPreference("ui-size-height"))
                }
                try {
                    thisOb.userPreference("ui-position-top")
                } catch (e) {
                    thisOb.userPreference("ui-position-top", thisOb.defaultPreference("ui-position-top"))
                }
                try {
                    thisOb.userPreference("ui-position-left")
                } catch (e) {
                    thisOb.userPreference("ui-position-left", thisOb.defaultPreference("ui-position-left"))
                }
            }
            if (rememberText) {
                try {
                    thisOb.userPreference("textarea-value")
                } catch (e) {
                    thisOb.userPreference("textarea-value", thisOb.defaultPreference("textarea-value"))
                }
            }
            if (options.id) {
                var containerEl = document.getElementById(options.id);
                if (containerEl) {
                    this.container = containerEl;
                    var isContainerVisible = ($(this.container).filter(":visible").length === 0) ? false : true;
                    if (isContainerVisible) {
                        var $textarea = $(containerEl).find("textarea.pte-text-editor");
                        var defaultLeft = thisOb.defaultPreference("ui-position-left");
                        var defaultTop = thisOb.defaultPreference("ui-position-top");
                        var defaultWidth = thisOb.defaultPreference("ui-size-width");
                        var defaultHeight = thisOb.defaultPreference("ui-size-height");
                        var heightDiff = $textarea.parent().parent().height() - $(thisOb.container).find(".CodeMirror").height();
                        var widthDiff = $textarea.parent().parent().width() - $(thisOb.container).find(".CodeMirror").width();
                        var syntaxHighlightingEnabled = $(thisOb.container).hasClass("mode-codeMirror");
                        var animationRequired = true;
                        if (parseInt($(containerEl).css("top"), 10) === defaultTop && parseInt($(containerEl).css("left"), 10) === defaultLeft) {
                            if (syntaxHighlightingEnabled) {
                                if ($(window.thisOb.myCodeMirror.getWrapperElement()).width() === defaultWidth && $(window.thisOb.myCodeMirror.getWrapperElement()).height() === defaultHeight) {
                                    animationRequired = false
                                }
                            } else {
                                if (parseInt($(containerEl).find("textarea.pte-text-editor").css("width"), 10) === defaultWidth && parseInt($(containerEl).find("textarea.pte-text-editor").css("height"), 10) === defaultHeight) {
                                    animationRequired = false
                                }
                            }
                        }
                        if (animationRequired === false) {
                            thisOb.focus()
                        } else {
                            var maxDuration = 750;
                            var textareaLeft = parseInt($(containerEl).css("left"), 10);
                            var textareaTop = parseInt($(containerEl).css("top"), 10);
                            var gapToCoverForPositioning = Math.sqrt(Math.pow((defaultLeft - textareaLeft), 2) + Math.pow((defaultTop - textareaTop), 2));
                            var $ta = $(containerEl).find("textarea.pte-text-editor");
                            var textareaWidth = parseInt($ta.css("width"), 10);
                            var textareaHeight = parseInt($ta.css("height"), 10);
                            var gapToCoverForResizing = Math.sqrt(Math.pow((defaultWidth - textareaWidth), 2) + Math.pow((defaultHeight - textareaHeight), 2));
                            var maxGapToCover = Math.max(gapToCoverForPositioning, gapToCoverForResizing);
                            var duration = 100 + maxDuration * (Math.sqrt(maxGapToCover) / Math.sqrt(maxDuration / 1.5));
                            duration = parseInt(duration, 10);
                            if (duration > maxDuration) {
                                duration = maxDuration
                            }
                            $(containerEl).css("width", "").css("height", "");
                            $(containerEl).animate({
                                top: defaultTop,
                                left: defaultLeft
                            }, duration);
                            $(containerEl).find("textarea.pte-text-editor").animate({
                                width: defaultWidth,
                                height: defaultHeight
                            }, duration, function() {
                                thisOb.initialWidth = $textarea.width();
                                thisOb.initialHeight = $textarea.height();
                                thisOb.focus();
                                if (rememberDimensions) {
                                    thisOb.userPreference("ui-size-width", defaultWidth);
                                    thisOb.userPreference("ui-size-height", defaultHeight);
                                    thisOb.userPreference("ui-position-top", defaultTop);
                                    thisOb.userPreference("ui-position-left", defaultLeft)
                                }
                            });
                            $(containerEl).find("textarea.pte-text-editor").parent().css("width", "").css("height", "");
                            var $elParent = $(containerEl).find("textarea.pte-text-editor").parent().parent();
                            var resizable = true;
                            if (options.resizable === false || options.resizable === null) {
                                resizable = false
                            }
                            resizable = true;
                            if (resizable) {}
                            refreshCodeMirror(window.thisOb.myCodeMirror);
                            try {
                                window.thisOb.triggerEvent("reInitialized", {
                                    animDuration: duration,
                                    targetWidth: defaultWidth,
                                    targetHeight: defaultHeight
                                })
                            } catch (e) {}
                        }
                    } else {
                        containerEl.pteObject.show()
                    }
                    return
                }
            }
            var container = document.createElement("div");
            this.container = container;
            this.container.pteObject = this;
            if (options.id) {
                this.container.id = options.id
            }
            this.container.style.fontFamily = 'Helvetica, "Trebuchet MS", sans-serif';
            this.container.style.outline = "1px solid transparent";
            if (rememberDimensions) {
                this.container.style.top = thisOb.userPreference("ui-position-top") + "px";
                this.container.style.left = thisOb.userPreference("ui-position-left") + "px"
            } else {
                this.container.style.top = "20px";
                this.container.style.left = "20px"
            }
            document.getElementsByTagName("body")[0].appendChild(this.container);
            var draggable = true;
            if (options.draggable === false || options.draggable === null) {
                draggable = false
            }
            if (draggable) {
                var fnEnableDragging = function() {
                    thisOb.container.style.cursor = "move";
                    $(thisOb.container).draggable({
                        distance: 10,
                        cancel: ".cancelDragHandle, textarea",
                        start: function(event, ui) {
                            $(thisOb.container).addClass("noclick");
                            $(thisOb.container).css("bottom", "").css("right", "")
                        },
                        stop: function(event, ui) {
                            window.setTimeout(function() {
                                $(thisOb.container).removeClass("noclick")
                            }, 0);
                            if (rememberDimensions) {
                                thisOb.userPreference("ui-position-top", ui.position.top);
                                thisOb.userPreference("ui-position-left", ui.position.left)
                            }
                        }
                    })
                };
                fnEnableDragging()
            }
            this.addChildComponents(options);
            this.init(options)
        };
        DefPlainTextEditor.prototype.noteCursorPosition = function() {
            if (thisOb.getTextEditorMode() === "code-mirror") {
                thisOb.previousCodeMirrorPosition = thisOb.getCursorPosition()
            } else {
                thisOb.previousTextAreaPosition = thisOb.getCursorPosition()
            }
        };
        DefPlainTextEditor.prototype.getCursorPosition = function() {
            if (thisOb.getTextEditorMode() === "code-mirror") {
                return thisOb.myCodeMirror.getCursor("start")
            } else {
                return $(thisOb.textarea).prop("selectionStart")
            }
        };
        DefPlainTextEditor.prototype.hasCursorMovedFromPreviousPosition = function() {
            if (thisOb.getTextEditorMode() === "code-mirror") {
                var previousCodeMirrorPosition = thisOb.previousCodeMirrorPosition || {};
                var currentCursorPosition = thisOb.getCursorPosition();
                if (currentCursorPosition.line === previousCodeMirrorPosition.line && currentCursorPosition.ch === previousCodeMirrorPosition.ch) {
                    return false
                }
            } else {
                if (thisOb.getCursorPosition() === thisOb.previousTextAreaPosition) {
                    return false
                }
            }
            return true
        };
        DefPlainTextEditor.prototype.triggerEvent = function(eventName, config) {
            var thisOb = this;
            var events = this.options.events;
            switch (eventName) {
                case "launched":
                    if (events.launched) {
                        events.launched(this)
                    }
                    break;
                case "reInitialized":
                    if (events.reInitialized) {
                        events.reInitialized(this, config)
                    }
                    break;
                case "beforeshow":
                    if (events.beforeshow) {
                        events.beforeshow(this)
                    }
                    break;
                case "aftershow":
                    if (events.aftershow) {
                        events.aftershow(this)
                    }
                    break;
                case "beforehide":
                    if (events.beforehide) {
                        events.beforehide(this)
                    }
                    break;
                case "afterhide":
                    if (events.afterhide) {
                        events.afterhide(this)
                    }
                    break;
                case "clear":
                    if (events.clear) {
                        events.clear(this)
                    }
                    this.triggerEvent("testfortextchange");
                    break;
                case "testfortextchange":
                    this.triggerEvent("textchange");
                    break;
                case "delayedtestfortextchange":
                    this.triggerEvent("delayedtextchange");
                    break;
                case "delayedcursormove":
                    if (events.delayedcursormove) {
                        events.delayedcursormove(this)
                    }
                    break;
                case "_delayedcursorprobablymoved":
                    if (thisOb.isVisible()) {
                        if (thisOb.hasCursorMovedFromPreviousPosition()) {
                            thisOb.triggerEvent("delayedcursormove")
                        }
                        thisOb.noteCursorPosition()
                    }
                    break;
                case "textchange":
                    if (events.textchange) {
                        events.textchange(this)
                    }
                    break;
                case "delayedtextchange":
                    if (events.delayedtextchange) {
                        events.delayedtextchange(this)
                    }
                    break;
                case "keyup":
                    if (events.keyup) {
                        events.keyup(this)
                    }
                    this.triggerEvent("testfortextchange");
                    break;
                case "delayedkeyup":
                    if (events.delayedkeyup) {
                        events.delayedkeyup(this)
                    }
                    this.triggerEvent("delayedtestfortextchange");
                    this.triggerEvent("_delayedcursorprobablymoved");
                    break;
                default:
                    consoleLog("An unexpected event was attempted to be triggered: " + eventName)
            }
        };
        DefPlainTextEditor.prototype.addChildComponents = function(options) {
            if (!this.container) {
                try {
                    console.warn("You might have used addChildComponents() before using create().")
                } catch (e) {}
            }
            var thisOb = this;
            var rememberText = thisOb.options.rememberText;
            var rememberDimensions = thisOb.options.rememberDimensions;
            var useCloseIcon = true;
            var useClearIcon = true;
            var useSyntaxHighlightingIcon = true;
            if (options.useCloseIcon === false || options.useCloseIcon === null) {
                useCloseIcon = false
            }
            if (options.useClearIcon === false || options.useClearIcon === null) {
                useClearIcon = false
            }
            if ((options.syntaxHighlighting && options.syntaxHighlighting.enabled) === false || (options.syntaxHighlighting && options.syntaxHighlighting.enabled) === null) {
                useSyntaxHighlightingIcon = false
            }
            var divHeader = document.createElement("div");
            this.container.appendChild(divHeader);
            var isIE7 = $.browser.msie && (document.documentMode || parseInt($.browser.version, 10)) === 7;
            if (isIE7) {
                var divClearFix = document.createElement("div");
                divClearFix.style.clear = "both";
                divClearFix.style.textAlign = "right";
                divClearFix.innerHTML = '<table style="direction:rtl; border-collapse:collapse;"><tr><td style="padding:0px;"><table style="direction:ltr; border-collapse:collapse;"><tr><td style="width:125px; padding:0px;"></td></tr></table></td></tr></table>';
                divHeader.appendChild(divClearFix);
                var parentDivRightAligned = $(divClearFix).find("td").get(1)
            } else {
                var parentDivRightAligned = divHeader
            }
            var divHeaderLeft = document.createElement("div");
            if (isIE7) {
                divHeaderLeft.style.marginTop = "-20px"
            }
            divHeader.appendChild(divHeaderLeft);
            if (divHeaderLeft.style.cssFloat !== undefined) {
                divHeaderLeft.style.cssFloat = "left"
            }
            if (divHeaderLeft.style.styleFloat !== undefined) {
                divHeaderLeft.style.styleFloat = "left"
            }
            var title;
            if (options.title) {
                title = options.title
            }
            if (title) {
                var divTitle = document.createElement("div");
                divTitle.style.backgroundColor = "#444";
                divTitle.style.borderRadius = "2px 2px 0px 0px";
                divTitle.style.paddingLeft = "5px";
                divTitle.style.paddingRight = "5px";
                divTitle.style.fontWeight = "bold";
                divTitle.style.color = "#ffffff";
                divTitle.style.letterSpacing = "1px";
                divTitle.style.fontFamily = 'Helvetica, "Trebuchet MS", sans-serif';
                divTitle.style.fontSize = "15px";
                divTitle.style.lineHeight = "20px";
                divTitle.innerHTML = title;
                var tooltip;
                if (options.tooltip) {
                    tooltip = options.tooltip
                }
                if (tooltip) {
                    $(divTitle).attr("title", tooltip)
                }
                divHeaderLeft.appendChild(divTitle)
            }
            var floatDirection = "right";
            if (useCloseIcon) {
                var divCloseIcon = document.createElement("div");
                if (divCloseIcon.style.cssFloat !== undefined) {
                    divCloseIcon.style.cssFloat = floatDirection
                }
                if (divCloseIcon.style.styleFloat !== undefined) {
                    divCloseIcon.style.styleFloat = floatDirection
                }
                divCloseIcon.style.cursor = "pointer";
                divCloseIcon.style.marginLeft = "10px";
                divCloseIcon.style.height = "20px";
                divCloseIcon.className = "pte-icon pte-icon-close";
                divCloseIcon.title = "Close";
                var imgCloseIcon = document.createElement("img");
                imgCloseIcon.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAe5JREFUeNqkk89KG1EUxr+ZubnUjJaipgtNtTZKxE1AVIi4yM5tF30Hoe/iA3TnQkTBRbZFKApCAl1142CJqLR0ZUNJJpPJZP70nJvcEK0SpAPfzD3n5vedM2dujCRJ8D+XODIMGMA4aYfibdLkCKZO+kxlP5FcwRla7MytrHxcLhazMp2WT5HcbeB5gVOp5H44Dqd2RdTb217a2Mi6vi/h+6O6lu9WV7M3jsPd7ppsQJqMTVO6rgtWdn8fev1YrpskkhlmzZBuLJ8qN5tNLJfLqgw/OX4sxyaaE2G/L8/z0Gq1cLy4iA+1mjKcOzhQ+RrFpmniy9oaUqkUMpkMNDcwCIIAYRhiwraxNz2NwskJLMtSgJQSZwSr6Xa7aDca/xowHFB7Xr0OO47vwazx4W9PJpozu2xK6hCY3N1hLIqQPz29BwshULq8RJp+x5JUTHODIRpkkKbv/GYI/ra+jq+FgjJgbV5dKYMX1KHmBh1ImgFv3pZKCr4geJZiVjWfV+2e53K9LqiQ5kSnfzwjmuIY+cxT8J3g+aF35nWVYJ1rx3HQ6R1pWNd0ewu8bkdRfkYI2zYMi/8M4oF0juGq7//8FUWHh0DF4L2XwMIW8H4KKFL8asRR/vObwHOg3ACu2YA6x0S/wHMunmHzrwADAPb07huzEp/RAAAAAElFTkSuQmCC";
                divCloseIcon.appendChild(imgCloseIcon);
                parentDivRightAligned.appendChild(divCloseIcon);
                $(divCloseIcon).click(function(evt) {
                    if ($(thisOb.container).hasClass("noclick")) {} else {
                        thisOb.hide()
                    }
                })
            }
            if (useClearIcon) {
                var divClearIcon = document.createElement("div");
                if (divClearIcon.style.cssFloat !== undefined) {
                    divClearIcon.style.cssFloat = floatDirection
                }
                if (divClearIcon.style.styleFloat !== undefined) {
                    divClearIcon.style.styleFloat = floatDirection
                }
                divClearIcon.style.cursor = "pointer";
                divClearIcon.style.marginLeft = "10px";
                divClearIcon.style.height = "20px";
                divClearIcon.className = "pte-icon pte-icon-clear";
                divClearIcon.title = "Clear text";
                var imgClearIcon = document.createElement("img");
                imgClearIcon.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAjJJREFUeNqkk8+LEmEYx593dlQQVPBvKAg8rAfBREITDXYHD7V0qVuXoTQwPMgSLkgXITxEUEyXZaGiW+y65KUfp6g5epdV9xY0Ooq/nZm3531zxNb11DO8PO+873ze7/d93ncIIQTsiMfjkEqlwOFwwNXCGxBwjM0KQMIUIAlACebPBsBPEygY2EQGRiIRiMVi4HK54JK4bgFN7n56+4yJVXfu2+v+YJNiJpPZBPK1LYCUVD0qdTUNrQiQrr0rfdy5t8WNAXwXYHMw+Nbu8WGpgzClaN6yoNPpwO3a+wMTQMJvbpBsNssdOJ3OZRZFcduyrPCTaxFF73a5MrNPFlk/Pwe/3w+1h/vP1xyg0vZ0Og3ncjnFSIWAoipTZg5YX2s2//YpL+KWcBGeTCbhfD6vzGYzME0T3HeTy0V+L2Cfzwcnj/Zf4OipsAqPx+NwoVBQ0AGH7ea6cxN+nZ3hGhaHq4+fvsRjPEEf34RV5WKxqGD+B2aticrWXoLDp7mDV1jAY8S+8mO0lcvlsjIajdaOot1uYw0F8Hq9sPfhtfyA0Cah5Is9LzLlSqWiDIfDNbjVai1hSZJkwzBUPMw6WflGtEFmdTWYbRtOJBIcdrvd9Ysigq7rajqdlj0eDy8Sa41Gg2c2Fo1G5X6/r+J7/bLbJqByXdM0NRgMygzCPi8WUw6FQvJgMNgI8y0s7Nd7vR4EAgF5Pp/z7Swui4rbWMJXJgS8+AtQ++jxIfyO/0f8EWAADzdBFBtx5MkAAAAASUVORK5CYII=";
                divClearIcon.appendChild(imgClearIcon);
                parentDivRightAligned.appendChild(divClearIcon);
                $(divClearIcon).click(function(evt) {
                    if ($(thisOb.container).hasClass("noclick")) {} else {
                        $(textarea).val("");
                        if (rememberText) {
                            thisOb.userPreference("textarea-value", $(textarea).val())
                        }
                        thisOb.focus();
                        thisOb.triggerEvent("clear")
                    }
                })
            }
            if (useSyntaxHighlightingIcon) {
                var divSHIcon = document.createElement("div");
                if (divSHIcon.style.cssFloat !== undefined) {
                    divSHIcon.style.cssFloat = floatDirection
                }
                if (divSHIcon.style.styleFloat !== undefined) {
                    divSHIcon.style.styleFloat = floatDirection
                }
                divSHIcon.className = "pte-icon pte-icon-syntaxHighlighting";
                divSHIcon.style.cursor = "pointer";
                divSHIcon.style.marginLeft = "10px";
                divSHIcon.style.height = "20px";
                divSHIcon.title = "Syntax Highlighting";
                var imgSHIcon = document.createElement("img");
                imgSHIcon.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAADQ0lEQVR4Xn3TDUzUZRwH8O+fgzu8Ay7uDxhMKY6XzruQiEMzQiYXYCtbLzQic9yYYZvioGtt6dBh04VwGo65AiqsXN5suJ0G5WqJLF8TcuEqKGGuyYvecS9yiPzv/627zY2x5md79vyePfvutz2/PVhMrzfFxcbGR2OBl1fqkBij0OJ/RGARq3XPRy3NZ4drajp3abXJmmWxqphyY9Kh3i3G4ZIsbSoe5LGsIjQ3D9xwHJPZ2RHk9m3fX+mvzLsg77ZQ3lvEL8pXNGKRSNwnIMrNAWMgEJXickuYDdzF+hV4suCKDMEbBJRRyFBq1gHYjYUyczK0O76qazrwW/3ttplq+ZMTg9zTOM6GnaOc/PJD8vlkyhVZlHe9wtHPLf6f+xQ9vb2ZR1rsz1SbTMkaGMyGxCMjrS5HcB8Pz21mz00Hm5pGadt6jr66fM7lKygfLaI8tY3yzWhyLpIyczl1yzpfXJxuQIjVvmFre2C7fMD3Bj8Ye41HT42wvrafYy88wfEt4MzvSyj9AnIMpF+gLIs8c8bwEwAh/AZdtpOHk6Q1ZdlVazfMcwIXxHcxn7Ee54ZEZCxRYSigR4q+ANmRRojSt/CM/XDv2Nee9wEwPMZK08OP14+wpHL/AGr6U1A1EQOLyw6DMIgZTz7a/ngaXdfO4+A/Tnw8/wgOjViGvzmtGULIm+YEfGddeZwNz5K1heSregafUtHz4nJ67TqePJXH1ft+5f5rrfKO66W0eyv5mVTHdxwbO8Jj7Pvbq9tZsqwUKgmIVgIxGgibyhGXdh5B0Y34+M24eFqBl1yvB+PSLwZVSpVKLYhYs85Ytbp0+KAAQKjIFXPLHk20PERlWuFbU28nmClAmgTvqtHpvoSaHh00aiU2rdp7Z2nCDbXCo7s6cfleR2/72S4sEjF0VXmHkpqcjWDgdhpNn04yom2O6naJkWXvtUGA+kF/QR6/lfkjFWbMcjmbHJoTf07MBtLjo7BKBMWgexBEAAv5/X54vV74fD6E2Gx5xZcub7ze0lJY63Q6k56rthUUNTqPV7T2/SXqs5cuyIT3UFAIHTweT6hGTk6OYDablf+F4XK5wit0n5qaquru7g7X09PT95sK/wIxMJR1N/EroAAAAABJRU5ErkJggg==";
                divSHIcon.appendChild(imgSHIcon);
                parentDivRightAligned.appendChild(divSHIcon);
                thisOb.divSHIcon = divSHIcon;
                $(divSHIcon).click(function(evt) {
                    if ($(thisOb.container).hasClass("noclick")) {} else {
                        if ($(divSHIcon).hasClass("disabled")) {
                            thisOb.enableDisableSyntaxHighlighting("enable");
                            thisOb.userPreference("syntax-highlighting", "yes")
                        } else {
                            thisOb.enableDisableSyntaxHighlighting("disable");
                            thisOb.userPreference("syntax-highlighting", "no")
                        }
                    }
                })
            }
            var useBeautifyIcon = true;
            if (useBeautifyIcon) {
                var divBeautifyIcon = document.createElement("div");
                if (divBeautifyIcon.style.cssFloat !== undefined) {
                    divBeautifyIcon.style.cssFloat = floatDirection
                }
                if (divBeautifyIcon.style.styleFloat !== undefined) {
                    divBeautifyIcon.style.styleFloat = floatDirection
                }
                divBeautifyIcon.className = "pte-icon pte-icon-beautify";
                divBeautifyIcon.style.cursor = "pointer";
                divBeautifyIcon.style.marginLeft = "10px";
                divBeautifyIcon.style.height = "20px";
                divBeautifyIcon.title = "Beautify CSS";
                var imgBeautifyIcon = document.createElement("img");
                imgBeautifyIcon.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACGUlEQVR4XpWTwUtUURTGv3vfc9KaxkJzM69FgQsFjWIKjIhqETIV5aaF/QUtDKJWLgwFt7aLaF9Cm6lVG0WCUJtmTIyZhSJEMy0ETdA3w7yZd+/X69LTmRTDH3wcON85hwv3HEESDeS6eiEio4SVCOSQClReEfQy0N4z+3xhCfWQ3FXuXIr5C+RiO5m1yAz+yqLKttJbOMtK9nSqvse8AMWnzdj+uAJ/3UH1Ow6ihjb4uqW47TudHX1zFWmMranJsPl/NGEDFlwnKlcnESCYT1wEdBrlBRyGUq0dpL4koSvjqP4wxuuZTtwaSZrYyF4vIl0I1sYlZUs31KZJvgnMnRi9jJD9PFt68LXoliTjoDLmg+srMPHOKeBYH0L284QgtNZxm1QIGQyKBm+3A9EuwJ2F4QCPWkPUlnqKdjUfBxQOAymw6UZ+Sig3r0UUIVNfHbyfO4N/MLnnqV6EVH0JS/h5qdE07Iu23QGLcbz60IWhlzeD2G009OKKya1tdQCxflNXrgj4Sg+DJP6sZzXTZtbW/WRzYvQuk8lkgybGBuguPyZX7wc1Fn/NCLPSZsDGlxvN5bRT8NInzBBmj3Btvp9L0w+N1hYfkYUn5HI/S7NHuT4tCrm3aN65hZDy544UyXsR6Zp/FvZxwIqBFKh5LkqlbQDq3clreiDs2XPO5fnWHq0xpjUTStMxXyX8ooDOSKFGYlf1N9TxG09xVDqmwvCaAAAAAElFTkSuQmCC";
                divBeautifyIcon.appendChild(imgBeautifyIcon);
                parentDivRightAligned.appendChild(divBeautifyIcon);
                thisOb.divBeautifyIcon = divBeautifyIcon;
                $(divBeautifyIcon).click(function(evt) {
                    if ($(thisOb.container).hasClass("noclick")) {} else {
                        var textValue = thisOb.getTextValue();
                        var output = cssbeautify(textValue, {
                            indent: "  ",
                            autosemicolon: true
                        });
                        if (textValue !== output) {
                            thisOb.setTextValue(output);
                            thisOb.reInitTextComponent()
                        }
                        thisOb.focus()
                    }
                })
            }
            var minifyCSS;
            var useMinifyIcon = true;
            if (useMinifyIcon) {
                minifyCSS = function() {
                    var textValue = thisOb.getTextValue();
                    var output = YAHOO.compressor.cssmin(textValue);
                    if (output.length > 5000 && thisOb.getTextEditorMode() === "code-mirror") {
                        thisOb.enableDisableSyntaxHighlighting("disable");
                        thisOb.userPreference("syntax-highlighting", "no");
                        alertNote("Syntax highlighting for very long, single line of text might slow down your browser for a few moments." + "<br />Turned off syntax highlighting due to performance reasons.", 10000)
                    }
                    thisOb.setTextValue(output);
                    thisOb.reInitTextComponent()
                }
            }
            var shareByEmail;
            var useEmailIcon = true;
            if (useEmailIcon) {
                var lastMailedValue = undefined;
                var lastSuccessNote = "";
                shareByEmail = function() {
                    var textValue = thisOb.getTextValue();
                    if ($.trim(textValue) === "") {
                        alertNote("No CSS code to be shared", 5000)
                    } else {
                        if (lastMailedValue === textValue) {
                            alertNote(lastSuccessNote, 20000)
                        } else {
                            alertNote("Request initiated. It might take a few moments. Please wait.", 5000);
                            $.ajax({
                                url: "https://api.github.com/gists",
                                type: "POST",
                                timeout: 20000,
                                contentType: "application/json",
                                data: JSON.stringify({
                                    "description": window.location.origin + " - MagiCSS",
                                    "public": true,
                                    "files": {
                                        "styles.css": {
                                            "content": textValue + "\r\n\r\n/* -- via MagiCSS for Chrome */\r\n"
                                        }
                                    }
                                }),
                                error: function(jqXHR, textStatus, errorThrown) {
                                    alertNote("An unexpected error has occured.<br />We could not reach GitHub Gist.", 10000)
                                },
                                success: function(json, textStatus, jqXHR) {
                                    if (textStatus === "success") {
                                        var url = json.html_url;
                                        var anchor = '<a target="_blank" href="' + url + '">' + url + "</a>";
                                        lastMailedValue = textValue;
                                        lastSuccessNote = "The GitHub Gist was successfully created: " + anchor + '<br/>Share code: <a target="_blank" href="' + "mailto:?subject=Use this CSS - " + url + "&body=" + encodeURIComponent(textValue.replace(/\t/g, "  ").substr(0, 140) + "\r\n...\r\n...\r\n\r\n" + url + "\r\n\r\n-- via MagiCSS for Chrome") + '">Send e-mail</a>';
                                        alertNote(lastSuccessNote, 10000)
                                    } else {
                                        alertNote("An unexpected error has occured.<br />We could not access GitHub Gist.", 10000)
                                    }
                                }
                            })
                        }
                    }
                }
            }
            var useContextMenuIcon = true;
            if (useContextMenuIcon) {
                var divContextMenuIcon = document.createElement("div");
                if (divContextMenuIcon.style.cssFloat !== undefined) {
                    divContextMenuIcon.style.cssFloat = floatDirection
                }
                if (divContextMenuIcon.style.styleFloat !== undefined) {
                    divContextMenuIcon.style.styleFloat = floatDirection
                }
                divContextMenuIcon.id = "magicss-context-menu";
                divContextMenuIcon.className = "pte-icon pte-icon-more";
                divContextMenuIcon.style.cursor = "pointer";
                divContextMenuIcon.style.marginLeft = "10px";
                divContextMenuIcon.style.height = "20px";
                var imgContextMenuIcon = document.createElement("img");
                imgContextMenuIcon.src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAAY0lEQVQ4jWNgwA2+MTAw/IdiH1yKmPAYwImDTbQBRIFhYAAjAyS0cQYSAeDLRIFmBgYGBk6qeMGRgYGBGYvcbiR2MwMDwyEsas7jM/w/Eg7FpWjgo3HgDWDBI+fEgIgdnKENAFl0DEYQmpCSAAAAAElFTkSuQmCC";
                divContextMenuIcon.appendChild(imgContextMenuIcon);
                parentDivRightAligned.appendChild(divContextMenuIcon);
                var $contextMenu = $("#magicss-context-menu");
                var tooltipContent = ["<ul>", '<li><a class="more-icons magicss-minify" href="javascript:void(0);" target="_blank">Minify CSS</a></li>', "", '<li><a class="more-icons magicss-tweet" href="http://twitter.com/intent/tweet?url=https://chrome.google.com/webstore/detail/magicss-live-css-editor/ifhikkcafabcgolfjegfcgloomalapol&hashtags=MagiCSS&text=MagiCSS - Live CSS Editor for Chrome ... a must for CSS developers!&via=JSBookmarklets" target="_blank">Tweet</a></li>', "</ul>"];
                $contextMenu.tooltipster({
                    functionBefore: function(origin, continueTooltip) {
                        var value = thisOb.getTextValue();
                        tooltipContent[2] = '<li><a class="more-icons magicss-email" href="javascript:void(0);">Gist and Mail CSS</a></li>';
                        $contextMenu.tooltipster("update", tooltipContent.join(""));
                        continueTooltip()
                    },
                    content: tooltipContent.join(""),
                    position: "bottom",
                    interactive: true,
                    interactiveTolerance: 350
                });
                $(document).on("click", ".magicss-minify,.magicss-email", function(evt) {
                    var $target = $(evt.target);
                    if ($target.hasClass("magicss-minify") && typeof minifyCSS === "function") {
                        minifyCSS()
                    } else {
                        if ($target.hasClass("magicss-email") && typeof shareByEmail === "function") {
                            shareByEmail()
                        }
                    }
                    $contextMenu.tooltipster("hide")
                })
            }
            thisOb.recallTextValue();
            var divContents = document.createElement("div");
            divContents.style.clear = "both";
            divContents.className = "raw-textarea-container";
            this.container.appendChild(divContents);
            var textarea = document.createElement("textarea");
            thisOb.textarea = textarea;
            textarea.className = "pte-text-editor";
            textarea.style.marginTop = "0px";
            textarea.style.fontFamily = "monospace";
            $(textarea).attr("spellcheck", "false");
            textarea.style.minHeight = "1px";
            divContents.appendChild(textarea);
            var $textarea = $(textarea);
            if (rememberText) {
                $textarea.val(thisOb.getTextValue())
            }
            if (rememberDimensions) {
                textarea.style.width = thisOb.userPreference("ui-size-width") + "px";
                textarea.style.height = thisOb.userPreference("ui-size-height") + "px"
            } else {
                textarea.style.width = thisOb.defaultPreference("ui-size-width") + "px";
                textarea.style.height = thisOb.defaultPreference("ui-size-height") + "px"
            }
            var textareaWrapAttr = "off";
            if (options.textareaWrapAttr) {
                textareaWrapAttr = options.textareaWrapAttr
            }
            $textarea.attr("wrap", textareaWrapAttr);
            $textarea.attr("placeholder", thisOb.readOption("placeholder"));
            if (rememberText) {
                $textarea.keyup(function(evt) {
                    thisOb.setTextValue($textarea.val())
                })
            }
            var resizable = true;
            if (options.resizable === false || options.resizable === null) {
                resizable = false
            }
            var isResizeSupported = false;
            if (window.getComputedStyle && window.getComputedStyle(textarea, null).getPropertyValue("resize")) {
                isResizeSupported = true
            }
            this.container.style.padding = "5px";
            if (isResizeSupported === false) {
                this.container.style.paddingBottom = "0px"
            }
            if (resizable) {
                if (isResizeSupported && !$.browser.webkit) {
                    textarea.style.resize = "both";
                    if (rememberDimensions) {
                        thisOb.initialWidth = thisOb.userPreference("ui-size-width");
                        thisOb.initialHeight = thisOb.userPreference("ui-size-height")
                    } else {
                        thisOb.initialWidth = thisOb.defaultPreference("ui-size-width");
                        thisOb.initialHeight = thisOb.defaultPreference("ui-size-height")
                    }
                    $textarea.mouseup(function(evt) {
                        if (rememberDimensions) {
                            thisOb.userPreference("ui-size-width", $(this).width());
                            thisOb.userPreference("ui-size-height", $(this).height())
                        }
                    })
                } else {
                    var fnAddRemoveResizable = window.fnAddRemoveResizable = function(addRemove) {
                        if (addRemove === "remove") {
                            $textarea.resizable("destroy");
                            return
                        }
                        var $uiWrapper = $textarea.css("border", "0").resizable({
                            handles: "se",
                            stop: function(event, ui) {
                                if (rememberDimensions) {
                                    thisOb.userPreference("ui-size-width", ui.size.width);
                                    thisOb.userPreference("ui-size-height", ui.size.height)
                                }
                            }
                        }).parents(".ui-wrapper").eq(0);
                        $uiWrapper.find(".ui-icon-gripsmall-diagonal-se").css("width", "12px").css("height", "16px");
                        if ($uiWrapper.css("position") === "static") {
                            $uiWrapper.css("position", "relative")
                        }
                        $uiWrapper.css("padding-bottom", "16px");
                        thisOb.focus()
                    };
                    window.setTimeout(fnAddRemoveResizable, 250)
                }
            } else {
                if (isResizeSupported) {
                    textarea.style.resize = "none"
                } else {}
            }(function() {
                $textarea.keydown(function(evt) {
                    var keyCode = evt.keyCode || evt.which;
                    if (keyCode === 9) {
                        evt.preventDefault();
                        var originalScrollTop = evt.target.scrollTop;
                        insertTextInFocusedTag($, evt.target, window.unescape("%09"));
                        evt.target.scrollTop = originalScrollTop
                    }
                })
            }());
            (function() {
                var t_timer;
                $textarea.keyup(function(evt) {
                    var events = options.events;
                    var delay;
                    if (typeof evt.shiftKey === "undefined") {
                        delay = 0
                    } else {
                        if (events.timeForDelayedkeyup) {
                            delay = events.timeForDelayedkeyup
                        } else {
                            delay = 500
                        }
                    }
                    window.clearTimeout(t_timer);
                    t_timer = window.setTimeout(function() {
                        thisOb.triggerEvent("delayedkeyup")
                    }, delay)
                });
                var fn = function() {
                    thisOb.triggerEvent("_delayedcursorprobablymoved")
                };
                $textarea.click(function(evt) {
                    runOnceFor(fn, 500)
                })
            }());
            (function() {
                if (typeof options.footer === "function") {
                    var $footer = options.footer($, thisOb);
                    $(thisOb.container).append($footer)
                }
            }());
            (function() {
                var closeOnEscapeKey = true;
                if (options.closeOnEscapeKey === false || options.closeOnEscapeKey === null) {
                    closeOnEscapeKey = false
                }
                if (closeOnEscapeKey) {
                    $textarea.keydown(function(evt) {
                        var keyCode = evt.keyCode || evt.which;
                        if (keyCode === 27) {
                            thisOb.hide()
                        }
                    })
                } else {
                    if ($.browser.msie) {
                        $textarea.keydown(function(evt) {
                            var keyCode = evt.keyCode || evt.which;
                            if (keyCode === 27) {
                                evt.preventDefault()
                            }
                        })
                    }
                }
            }());
            (function() {
                var syntaxHighlighting = (thisOb.options.syntaxHighlighting && thisOb.options.syntaxHighlighting.enabled) || false;
                if (syntaxHighlighting) {
                    thisOb.createSyntaxHighlighting();
                    thisOb.enableDisableSyntaxHighlighting("enable")
                } else {
                    thisOb.enableDisableSyntaxHighlighting("disable")
                }
                if (thisOb.userPreference("syntax-highlighting") === "no") {
                    thisOb.enableDisableSyntaxHighlighting("disable")
                } else {
                    thisOb.enableDisableSyntaxHighlighting("enable")
                }
            }());
            $(thisOb.container).bind("mousewheel DOMMouseScroll", function(e) {
                var that = this;
                var $that = $(that);
                var delta = e.originalEvent.wheelDelta || -e.originalEvent.detail;
                var vScrollBar;
                if ($that.hasClass("mode-textarea")) {
                    vScrollBar = $(this).find("textarea.pte-text-editor")
                } else {
                    vScrollBar = $(this).find(".CodeMirror-vscrollbar")
                }
                if (delta > 0) {
                    if (vScrollBar[0].scrollTop === 0) {
                        e.preventDefault()
                    }
                } else {
                    var originalScroll = vScrollBar.scrollTop();
                    vScrollBar.scrollTop(originalScroll + 1);
                    var newScroll = vScrollBar.scrollTop();
                    vScrollBar.scrollTop(originalScroll);
                    if (originalScroll === newScroll) {
                        e.preventDefault()
                    }
                }
            });
            thisOb.focus();
            thisOb.triggerEvent("launched")
        };
        DefPlainTextEditor.prototype.isVisible = function(options) {
            if (this.hidden) {
                return false
            } else {
                return true
            }
        };
        DefPlainTextEditor.prototype.init = function(options) {
            if (!this.container) {
                try {
                    console.warn("You might have used init() before using create().")
                } catch (e) {}
            }
            var thisOb = this;
            var rememberDimensions = thisOb.options.rememberDimensions;
            $(thisOb.container).addClass("container");
            thisOb.container.style.position = "fixed";
            if (rememberDimensions) {
                thisOb.container.style.top = thisOb.userPreference("ui-position-top") + "px";
                thisOb.container.style.left = thisOb.userPreference("ui-position-left") + "px"
            } else {
                thisOb.container.style.top = "20px";
                thisOb.container.style.left = "20px"
            }
            thisOb.container.style.width = "auto";
            thisOb.container.style.height = "auto";
            this.container.style.borderRadius = "2px";
            this.container.style.zIndex = "99999999999999999999999";
            if (this.container.style.zIndex !== "99999999999999999999999") {
                this.container.style.zIndex = "2147483647"
            }
            var bgColorInsideRGBA = (options && options.bgColor) ? options.bgColor : "";
            try {
                this.container.style.backgroundColor = "rgba(" + bgColorInsideRGBA + ")"
            } catch (e) {}
            if (typeof this.container.style.filter !== "undefined") {
                var bgColorInsideFilter = DefPlainTextEditor.RGBaToFilter(bgColorInsideRGBA);
                this.container.style.filter = "progid:DXImageTransform.Microsoft.gradient(startColorstr=#" + bgColorInsideFilter + ", endColorstr=#" + bgColorInsideFilter + ")"
            }
        };
        DefPlainTextEditor.prototype.getTextareaValue = function() {
            return $(this.textarea).val()
        };
        DefPlainTextEditor.prototype.focus = function() {
            if (this.getTextEditorMode() === "code-mirror") {
                var myCodeMirror = window.thisOb && window.thisOb.myCodeMirror;
                window.setTimeout(function() {
                    myCodeMirror.focus()
                }, 0)
            } else {
                var that = this;
                window.setTimeout(function() {
                    $(that.textarea).focus()
                }, 0)
            }
        };
        DefPlainTextEditor.prototype.recallTextValue = function(val) {
            if (this.options && this.options.rememberText) {
                this.textValue = this.userPreference("textarea-value")
            }
        };
        DefPlainTextEditor.prototype.getTextValue = function(val) {
            return this.textValue || ""
        };
        DefPlainTextEditor.prototype.setTextValue = function(val) {
            if (this.options && this.options.rememberText) {
                this.userPreference("textarea-value", val)
            }
            this.textValue = val
        };
        DefPlainTextEditor.prototype.getTextValueForNLines = function(line) {
            var textValue = this.getTextValue();
            var delimiter = "\n",
                start = line,
                tokens = textValue.split(delimiter).slice(0, start),
                result = tokens.join(delimiter);
            return result
        };
        DefPlainTextEditor.prototype.setTextareaValue = function(val) {
            $(this.textarea).val(val)
        };
        DefPlainTextEditor.prototype.setCodeMirrorValue = function(val) {
            this.myCodeMirror.setValue(val)
        };
        DefPlainTextEditor.prototype.saveTextContainerDimensions = function(options) {
            this.userPreference("ui-size-width", options.width);
            this.userPreference("ui-size-height", options.height)
        };
        DefPlainTextEditor.prototype.setTextContainerDimensions = function(options, propagateTo) {
            this.saveTextContainerDimensions(options);
            if (propagateTo === "codemirror") {
                this.setCodeMirrorDimensions(options)
            }
        };
        DefPlainTextEditor.prototype.getTextContainerDimensions = function() {
            return {
                width: this.userPreference("ui-size-width"),
                height: this.userPreference("ui-size-height")
            }
        };
        DefPlainTextEditor.prototype.setCodeMirrorDimensions = function(options) {
            this.myCodeMirror.setSize(options.width, options.height)
        };
        DefPlainTextEditor.prototype.setTextareaDimensions = function(options) {
            var $ta = $(this.textarea);
            $ta.width(options.width - 8).height(options.height - 8);
            $ta.parents(".ui-wrapper").width(options.width).height(options.height)
        };
        DefPlainTextEditor.prototype.hide = function(args) {
            this.triggerEvent("beforehide");
            this.container.style.display = "none";
            this.hidden = true;
            this.triggerEvent("afterhide")
        };
        DefPlainTextEditor.prototype.show = function(args) {
            this.triggerEvent("beforeshow");
            this.container.style.display = "";
            this.hidden = false;
            this.focus();
            this.triggerEvent("aftershow")
        };
        DefPlainTextEditor.prototype.readOption = function(option) {
            var thisOb = this;
            var options = thisOb.options;
            if (option === "placeholder") {
                return options.placeholder || ""
            }
        };
        DefPlainTextEditor.prototype.defaultPreference = function(pref) {
            var defaultValue;
            if (pref === "syntax-highlighting") {
                defaultValue = "yes"
            } else {
                if (pref === "textarea-value") {
                    defaultValue = ""
                } else {
                    if (pref === "ui-position-left") {
                        defaultValue = 20
                    } else {
                        if (pref === "ui-position-top") {
                            defaultValue = 20
                        } else {
                            if (pref === "ui-size-height") {
                                defaultValue = 250
                            } else {
                                if (pref === "ui-size-width") {
                                    defaultValue = 300
                                } else {
                                    defaultValue = ""
                                }
                            }
                        }
                    }
                }
            }
            return defaultValue
        };
        DefPlainTextEditor.prototype.userPreference = function(pref, value) {
            var prefix = this.options.localDataKeyPrefix;
            var defaultValue;
            if (value !== undefined) {} else {
                defaultValue = this.defaultPreference(pref)
            }
            if (pref === "invalid-preference") {} else {
                if (value !== undefined) {
                    amplify.store(prefix + pref, value)
                } else {
                    return amplify.store(prefix + pref) || defaultValue
                }
            }
        };
        DefPlainTextEditor.prototype.createSyntaxHighlighting = function() {
            var thisOb = this;
            var newDiv = $("<div></div>").addClass("raw-codemirror-container");
            $(thisOb.textarea).parent().after(newDiv);
            var closeOnEscapeKey = true;
            if (thisOb.options.closeOnEscapeKey === false || thisOb.options.closeOnEscapeKey === null) {
                closeOnEscapeKey = false
            }
            var myCodeMirror = CodeMirror(newDiv.get(0), {
                value: thisOb.textarea.value,
                mode: "css",
                placeholder: thisOb.readOption("placeholder"),
                indentUnit: 2,
                indentWithTabs: false,
                undoDepth: 1000,
                onKeyEvent: function(cm, evt) {
                    var keyCode = evt.keyCode || evt.which;
                    if (keyCode === 27) {
                        if (closeOnEscapeKey) {
                            thisOb.hide()
                        }
                    }
                }
            });
            thisOb.myCodeMirror = myCodeMirror;
            window.thisOb = thisOb;
            var dimWH = thisOb.getTextContainerDimensions();
            myCodeMirror.setSize(dimWH.width, dimWH.height);
            var t_timer;
            myCodeMirror.on("change", function() {
                refreshCodeMirror(myCodeMirror);
                var delay = 500;
                window.clearTimeout(t_timer);
                t_timer = window.setTimeout(function() {
                    thisOb.setTextValue(myCodeMirror.getValue());
                    thisOb.triggerEvent("delayedtextchange")
                }, delay)
            });
            var fn = function() {
                thisOb.triggerEvent("_delayedcursorprobablymoved")
            };
            myCodeMirror.on("cursorActivity", function(cm, event) {
                runOnceFor(fn, 500)
            });
            $(myCodeMirror.getWrapperElement()).addClass("cancelDragHandle");
            $(myCodeMirror.getWrapperElement()).resizable({
                handles: "se",
                stop: function(event, ui) {
                    refreshCodeMirror(myCodeMirror);
                    thisOb.setTextContainerDimensions({
                        width: ui.size.width,
                        height: ui.size.height
                    }, "codemirror")
                }
            })
        };
        DefPlainTextEditor.prototype.indicateEnabledDisabled = function(enabledDisabled) {
            if (enabledDisabled === "enabled") {
                $(this.container).removeClass("indicate-disabled").addClass("indicate-enabled")
            } else {
                $(this.container).removeClass("indicate-enabled").addClass("indicate-disabled")
            }
        };
        DefPlainTextEditor.prototype.reInitTextComponent = function() {
            if ($(this.container).hasClass("mode-codeMirror")) {
                this.reInitCodeMirror()
            } else {
                this.reInitTextarea()
            }
        };
        DefPlainTextEditor.prototype.getAlertNote = function(val) {
            return alertNote
        };
        DefPlainTextEditor.prototype.splitTextByCursor = function(val) {
            var thisOb = this;
            var strBeforeCursor, strAfterCursor;
            if (thisOb.getTextEditorMode() === "code-mirror") {
                var cm = this.myCodeMirror;
                strBeforeCursor = cm.getRange({
                    line: 0,
                    ch: 0
                }, cm.getCursor("start"));
                strAfterCursor = cm.getValue().substr(strBeforeCursor.length)
            } else {
                var pos = $(thisOb.textarea).prop("selectionStart");
                strBeforeCursor = thisOb.textValue.substr(0, pos);
                strAfterCursor = thisOb.textValue.substr(pos)
            }
            return {
                strBeforeCursor: strBeforeCursor,
                strAfterCursor: strAfterCursor
            }
        };
        DefPlainTextEditor.prototype.getTextEditorMode = function(options) {
            if ($(this.container).hasClass("mode-codeMirror")) {
                return "code-mirror"
            } else {
                return "textarea"
            }
        };
        DefPlainTextEditor.prototype.focusTextComponent = function(options) {
            var thisOb = this;
            var line = 0,
                ch = 0;
            if (options) {
                line = options.line || 0;
                ch = options.ch || 0
            }
            if ($(this.container).hasClass("mode-codeMirror")) {
                thisOb.myCodeMirror.setCursor({
                    line: line,
                    ch: 0
                })
            } else {
                var textValue = thisOb.getTextValue();
                var nLines = textValue.match(/\n/g).length + 1;
                var delimiter = "\n",
                    start = line,
                    tokens = textValue.split(delimiter).slice(start),
                    result = tokens.join(delimiter);
                $(thisOb.textarea).setSelection(textValue.length - result.length);
                $(thisOb.textarea).focus();
                thisOb.textarea.scrollTop = (line / nLines) * thisOb.textarea.scrollHeight - thisOb.textarea.clientHeight + 20
            }
        };
        DefPlainTextEditor.prototype.reInitTextarea = function() {
            var thisOb = this;
            this.setTextareaValue(this.getTextValue());
            thisOb.setTextareaDimensions(thisOb.getTextContainerDimensions());
            var $that = $(this.container);
            $that.removeClass("mode-codeMirror").addClass("mode-textarea");
            window.setTimeout(function() {}, 250)
        };
        DefPlainTextEditor.prototype.reInitCodeMirror = function() {
            var thisOb = this;
            this.setCodeMirrorValue(this.getTextValue());
            thisOb.setCodeMirrorDimensions(thisOb.getTextContainerDimensions());
            var $that = $(this.container);
            $that.removeClass("mode-textarea").addClass("mode-codeMirror")
        };
        DefPlainTextEditor.prototype.enableDisableSyntaxHighlighting = function(enableDisable) {
            var thisOb = this;
            if (enableDisable === "disable") {
                $(this.container).removeClass("mode-codeMirror").addClass("mode-textarea");
                var cursorPos = thisOb.myCodeMirror.getRange({
                    line: 0,
                    ch: 0
                }, thisOb.myCodeMirror.getCursor("start")).length;
                $(thisOb.divSHIcon).removeClass("enabled").addClass("disabled");
                $(".raw-codemirror-container").hide();
                $(thisOb.textarea).closest(".raw-textarea-container").show();
                this.reInitTextarea();
                $(thisOb.textarea).setSelection(cursorPos);
                thisOb.focus();
                var nLines = thisOb.myCodeMirror.lineCount();
                var iLine = thisOb.myCodeMirror.getCursor("start").line;
                thisOb.textarea.scrollTop = (iLine / nLines) * thisOb.textarea.scrollHeight - thisOb.textarea.clientHeight + 20
            } else {
                $(this.container).removeClass("mode-textarea").addClass("mode-codeMirror");
                var cursorPos = $(thisOb.textarea).prop("selectionStart");
                $(thisOb.divSHIcon).removeClass("disabled").addClass("enabled");
                $(thisOb.textarea).closest(".raw-textarea-container").hide();
                $(".raw-codemirror-container").show();
                this.reInitCodeMirror();
                var readCount = 0;
                var flag = true;
                var lineIndex = 0;
                this.myCodeMirror.eachLine(function(line) {
                    if (flag) {
                        if ((readCount + line.text.length + 1) > cursorPos) {
                            flag = false
                        } else {
                            readCount += line.text.length + 1;
                            lineIndex++
                        }
                    }
                });
                this.myCodeMirror.setCursor({
                    line: lineIndex,
                    ch: cursorPos - readCount
                });
                thisOb.focus()
            }
        };
        DefPlainTextEditor.RGBaToFilter = (function() {
            var hexvals = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "A", "B", "C", "D", "E", "F"];
            var getAlpha = function(alpha) {
                alpha = parseFloat(alpha, 10);
                if (alpha < 0) {
                    alpha = 0
                } else {
                    if (alpha > 1) {
                        alpha = 1
                    }
                }
                alpha = alpha * 255;
                return (hexvals[parseInt((alpha / 16), 10)] + hexvals[parseInt((alpha % 16), 10)])
            };
            var parseRGBa = function(rgba) {
                rgba = rgba.split(",");
                var a = rgba[3] || 1,
                    c, current, filterValue = "";
                for (c = 0; c < 3; c++) {
                    current = parseInt(rgba[c], 10);
                    if (current < 0) {
                        current = 0
                    } else {
                        if (current > 255) {
                            current = 255
                        }
                    }
                    filterValue += (hexvals[parseInt((current / 16), 10)] + hexvals[parseInt((current % 16), 10)])
                }
                filterValue = getAlpha(a) + filterValue;
                return filterValue
            };
            return parseRGBa
        }());
        return DefPlainTextEditor
    }());
    window.PlainTextEditor = PlainTextEditor;
    var isDataURISupported = true;
    (function() {
        inSequence([function(next) {
            var data = new Image();
            data.onload = data.onerror = function() {
                if (this.width !== 1 || this.height !== 1) {
                    isDataURISupported = false
                }
            };
            data.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";
            window.setTimeout(function() {
                next()
            }, 32)
        }, function(next, frameWindow, parentUrl, elFrame) {
            $ = jQuery = window.jQuery;
            next(frameWindow, parentUrl, elFrame)
        }, function(next, frameWindow, parentUrl, elFrame) {
            fnInitRangyInputs($);
            next(frameWindow, parentUrl, elFrame)
        }, function(next, frameWindow, parentUrl, elFrame) {
            PlainTextEditor.usable = true
        }])
    }).call(this)
}).call(this);